<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üå± BloomWatch Kids - Learn About Plants & Nature!</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Fun educational app for kids to learn about plants, nature, and conservation using real NASA data!">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="BloomWatch">
    <meta name="msapplication-TileColor" content="#28a745">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#28a745">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Comic+Neue:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        // Ensure OrbitControls is available
        if (typeof THREE !== 'undefined' && typeof THREE.OrbitControls === 'undefined') {
            // Fallback: create a simple orbit control if the import failed
            THREE.OrbitControls = function(camera, domElement) {
                this.camera = camera;
                this.domElement = domElement;
                this.enableDamping = true;
                this.dampingFactor = 0.05;
                this.enableZoom = true;
                this.enablePan = false;
                this.minDistance = 1.5;
                this.maxDistance = 5;
                
                this.update = function() {
                    // Simple rotation
                    this.camera.position.x = Math.cos(Date.now() * 0.0005) * 3;
                    this.camera.position.z = Math.sin(Date.now() * 0.0005) * 3;
                    this.camera.lookAt(0, 0, 0);
                };
                
                this.reset = function() {
                    this.camera.position.set(0, 0, 3);
                };
            };
        }
    </script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
        <div class="container">
            <a class="navbar-brand" href="#">
                üå± BloomWatch Kids
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link active" href="{{ url_for('index') }}">üè† Home</a>
                <a class="nav-link" href="{{ url_for('explore') }}">üåç Explore</a>
                <a class="nav-link" href="{{ url_for('learn') }}">üéì Learn</a>
                <a class="nav-link" href="{{ url_for('games') }}">üéÆ Games</a>
                <a class="nav-link" href="{{ url_for('share') }}">üì∏ Share</a>
                <span class="navbar-text ms-3" id="currentLocationDisplay">
                    üöÄ Powered by NASA Space Data!
                </span>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h1 class="display-4 fw-bold text-white mb-4">
                        üåü Discover Amazing Plants Around the World! üåü
                    </h1>
                    <p class="lead text-white mb-4">
                        Join us on an exciting adventure to learn about plants, flowers, and nature! 
                        We use real NASA satellite pictures from space to see how plants grow all over our beautiful Earth! üåç‚ú®
                    </p>
                    <div class="d-flex flex-wrap gap-3">
                        <a href="{{ url_for('explore') }}" class="btn btn-light btn-lg">
                            üåç Explore the World Map
                        </a>
                        <a href="{{ url_for('learn') }}" class="btn btn-outline-light btn-lg">
                            üéì Learn About Plants
                        </a>
                        <a href="{{ url_for('games') }}" class="btn btn-outline-light btn-lg">
                            üéÆ Play Games
                        </a>
                        <a href="{{ url_for('share') }}" class="btn btn-outline-light btn-lg">
                            üì∏ Share Photos
                        </a>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="hero-stats">
                        <div class="row text-center">
                            <div class="col-3">
                                <div class="stat-item">
                                    <h3 class="text-white">üå±</h3>
                                    <p class="text-white-50">Plants</p>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="stat-item">
                                    <h3 class="text-white">üåç</h3>
                                    <p class="text-white-50">World Map</p>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="stat-item">
                                    <h3 class="text-white">üöÄ</h3>
                                    <p class="text-white-50">NASA Space</p>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="stat-item">
                                    <h3 class="text-white">üéì</h3>
                                    <p class="text-white-50">Learning</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Activity Cards Section -->
    <div class="container my-5">
        <div class="row">
            <div class="col-12">
                <h2 class="text-center mb-4">üåü Choose Your Adventure! üåü</h2>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6 col-lg-3 mb-4">
                <div class="card activity-card h-100 shadow" onclick="window.location.href='{{ url_for('explore') }}'">
                    <div class="card-header bg-primary text-white text-center">
                        <h4 class="mb-0">üåç</h4>
                    </div>
                    <div class="card-body text-center">
                        <h5 class="card-title">Explore the World</h5>
                        <p class="card-text">Use our interactive map to discover plants from around the globe!</p>
                        <div class="d-flex justify-content-center">
                            <small class="text-muted">Interactive Map</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 col-lg-3 mb-4">
                <div class="card activity-card h-100 shadow" onclick="window.location.href='{{ url_for('learn') }}'">
                    <div class="card-header bg-success text-white text-center">
                        <h4 class="mb-0">üéì</h4>
                    </div>
                    <div class="card-body text-center">
                        <h5 class="card-title">Learn About Plants</h5>
                        <p class="card-text">Discover amazing facts about plants, nature, and how they grow!</p>
                        <div class="d-flex justify-content-center">
                            <small class="text-muted">Educational</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 col-lg-3 mb-4">
                <div class="card activity-card h-100 shadow" onclick="window.location.href='{{ url_for('games') }}'">
                    <div class="card-header bg-warning text-dark text-center">
                        <h4 class="mb-0">üéÆ</h4>
                    </div>
                    <div class="card-body text-center">
                        <h5 class="card-title">Play Fun Games</h5>
                        <p class="card-text">Enjoy interactive games while learning about plants and nature!</p>
                        <div class="d-flex justify-content-center">
                            <small class="text-muted">Interactive Games</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 col-lg-3 mb-4">
                <div class="card activity-card h-100 shadow" onclick="window.location.href='{{ url_for('share') }}'">
                    <div class="card-header bg-info text-white text-center">
                        <h4 class="mb-0">üì∏</h4>
                    </div>
                    <div class="card-body text-center">
                        <h5 class="card-title">Share Your Photos</h5>
                        <p class="card-text">Take photos of plants and share them with other kids!</p>
                        <div class="d-flex justify-content-center">
                            <small class="text-muted">Citizen Science</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions Section -->
    <div class="container my-5">
        <div class="row">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header bg-light text-center">
                        <h5 class="mb-0">üéØ Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <a href="{{ url_for('explore') }}" class="btn btn-primary w-100 btn-lg">
                                    üîÆ Predict Plant Growth!
                                </a>
                            </div>
                            <div class="col-md-4 mb-3">
                                <a href="{{ url_for('games') }}" class="btn btn-warning w-100 btn-lg">
                                    üîç Find Special Plants!
                                </a>
                            </div>
                            <div class="col-md-4 mb-3">
                                <a href="{{ url_for('share') }}" class="btn btn-info w-100 btn-lg">
                                    üå°Ô∏è Weather & Plants
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Global Map Section -->
    <div class="container my-5" id="mapSection">
        <div class="row">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header bg-light text-center">
                        <h5 class="mb-0">üåç Amazing Plant World Map</h5>
                        <small class="text-muted">Click on the colorful dots to learn about plants in different places! üå±</small>
                    </div>
                    <div class="card-body p-0">
                        <div id="globalMap" style="height: 500px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analysis Section -->
    <div class="container my-5" id="analysisSection">
        <!-- Chart and Metrics Row -->
        <div class="row mb-4">
            <!-- Time Series Chart -->
            <div class="col-lg-8">
                <div class="card shadow h-100">
                    <div class="card-header bg-light text-center">
                        <h5 class="mb-0">üìà How Plants Grow Over Time!</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="timeSeriesChart" height="300"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Key Metrics -->
            <div class="col-lg-4">
                <div class="card shadow h-100">
                    <div class="card-header bg-light text-center">
                        <h5 class="mb-0">üìä Plant Health Scoreboard!</h5>
                    </div>
                    <div class="card-body">
                        <div class="metric-item mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span>üå± How Green Are the Plants?</span>
                                <span class="fw-bold" id="currentIntensity">-</span>
                            </div>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar bg-success" id="intensityBar" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div class="metric-item mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>üå∏ Best Blooming Day</span>
                                <span class="fw-bold" id="peakDate">-</span>
                            </div>
                        </div>
                        
                        <div class="metric-item mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>üìà Are Plants Growing More?</span>
                                <span class="fw-bold" id="trend">-</span>
                            </div>
                        </div>
                        
                        <div class="metric-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>üå∫ Best Season for Flowers</span>
                                <span class="fw-bold" id="peakSeason">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Citizen Science & NASA Attribution Row -->
        <div class="row mb-4">
            <!-- Citizen Science Observations -->
            <div class="col-lg-8">
                <div class="card shadow h-100">
                    <div class="card-header bg-success text-white text-center">
                        <h5 class="mb-0">üå± Citizen Science Observations</h5>
                    </div>
                    <div class="card-body">
                        <p class="text-center mb-4">Help us track blooms worldwide! Submit your observations.</p>
                        <div id="citizenObservationsList">
                            <div class="alert alert-info text-center">
                                <i class="fas fa-spinner fa-spin me-2"></i>Loading citizen observations...
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <a href="{{ url_for('share') }}" class="btn btn-success">
                                üì∏ Share Your Plant Photos!
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- NASA Attribution & Resources -->
            <div class="col-lg-4">
                <div class="card shadow h-100">
                    <div class="card-header bg-info text-white text-center">
                        <h5 class="mb-0">üöÄ NASA Resources</h5>
                    </div>
                    <div class="card-body">
                        <h6 class="text-primary mb-3">üìä Data Sources</h6>
                        <p class="small mb-3">Climate and weather data for renewable energy applications</p>
                        <p class="small mb-3"><strong>Provider:</strong> NASA Langley Research Center</p>
                        
                        <h6 class="text-primary mb-3">üìã Usage Terms</h6>
                        <p class="small mb-2">NASA data is freely available for research and educational purposes</p>
                        <p class="small mb-2"><strong>Attribution:</strong> Data provided by NASA Earth Science Data Systems</p>
                        <p class="small mb-3"><strong>Disclaimer:</strong> This application uses NASA data for demonstration purposes</p>
                        
                        <div class="text-center mt-4">
                            <small class="text-muted">
                                üìÖ Last updated: <span id="lastUpdateTime">-</span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Hidden AI & Advanced Analytics (for future use) -->
        <div class="row mb-4" style="display: none;">
            <div class="col-lg-8">
                <div class="card shadow" id="predictionCard">
                    <!-- AI Prediction content will be loaded here -->
                </div>
            </div>
            <div class="col-lg-4">
                <div class="row">
                    <div class="col-12 mb-3">
                        <div class="card shadow" id="anomaliesCard">
                            <!-- Anomaly detection content will be loaded here -->
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="card shadow" id="climateCard">
                            <!-- Climate correlation content will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Conservation Insights -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header bg-light text-center">
                        <h5 class="mb-0">üåø Fun Plant Facts & How to Help Nature!</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>üåü Cool Plant Facts!</h6>
                                <ul id="insightsList" class="list-unstyled">
                                    <li><i class="fas fa-spinner fa-spin me-2"></i>Loading fun facts...</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>üå± How You Can Help Plants!</h6>
                                <ul id="recommendationsList" class="list-unstyled">
                                    <li><i class="fas fa-spinner fa-spin me-2"></i>Loading helpful tips...</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h6>üå± BloomWatch Kids</h6>
                    <p class="mb-0">Learning about plants and nature with real NASA space data! üöÄ</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">üöÄ Powered by NASA Space Data! üåü</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Loading Modal -->
    <div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center py-4">
                    <div class="spinner-border text-success mb-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h5>üöÄ Getting Data from Space!</h5>
                    <p class="text-muted">Looking at satellite pictures to see how plants are growing! üå±</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Analytics Modal -->
    <div class="modal fade" id="analyticsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-chart-pie me-2"></i>Advanced Analytics Dashboard
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-database me-2"></i>Data Quality Metrics</h6>
                                </div>
                                <div class="card-body">
                                    <div id="dataQualityMetrics">
                                        <div class="metric-item mb-2">
                                            <span>Completeness: </span>
                                            <span class="fw-bold" id="dataCompleteness">-</span>
                                        </div>
                                        <div class="metric-item mb-2">
                                            <span>Accuracy: </span>
                                            <span class="fw-bold" id="dataAccuracy">-</span>
                                        </div>
                                        <div class="metric-item mb-2">
                                            <span>Timeliness: </span>
                                            <span class="fw-bold" id="dataTimeliness">-</span>
                                        </div>
                                        <div class="metric-item">
                                            <span>Coverage: </span>
                                            <span class="fw-bold" id="dataCoverage">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-brain me-2"></i>AI Model Performance</h6>
                                </div>
                                <div class="card-body">
                                    <div id="modelPerformance">
                                        <div class="metric-item mb-2">
                                            <span>Prediction Accuracy: </span>
                                            <span class="fw-bold" id="predictionAccuracy">-</span>
                                        </div>
                                        <div class="metric-item mb-2">
                                            <span>Model Confidence: </span>
                                            <span class="fw-bold" id="modelConfidence">-</span>
                                        </div>
                                        <div class="metric-item mb-2">
                                            <span>Training Data Points: </span>
                                            <span class="fw-bold" id="trainingDataPoints">-</span>
                                        </div>
                                        <div class="metric-item">
                                            <span>Last Updated: </span>
                                            <span class="fw-bold" id="lastModelUpdate">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-users me-2"></i>User Engagement</h6>
                                </div>
                                <div class="card-body">
                                    <div id="userEngagement">
                                        <div class="metric-item mb-2">
                                            <span>Session Duration: </span>
                                            <span class="fw-bold" id="sessionDuration">-</span>
                                        </div>
                                        <div class="metric-item mb-2">
                                            <span>Interactions: </span>
                                            <span class="fw-bold" id="userInteractions">-</span>
                                        </div>
                                        <div class="metric-item mb-2">
                                            <span>Features Used: </span>
                                            <span class="fw-bold" id="featuresUsed">-</span>
                                        </div>
                                        <div class="metric-item">
                                            <span>Data Exports: </span>
                                            <span class="fw-bold" id="dataExports">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-tachometer-alt me-2"></i>System Performance</h6>
                                </div>
                                <div class="card-body">
                                    <div id="systemPerformance">
                                        <div class="metric-item mb-2">
                                            <span>Page Load Time: </span>
                                            <span class="fw-bold" id="pageLoadTime">-</span>
                                        </div>
                                        <div class="metric-item mb-2">
                                            <span>Memory Usage: </span>
                                            <span class="fw-bold" id="memoryUsage">-</span>
                                        </div>
                                        <div class="metric-item mb-2">
                                            <span>API Response Time: </span>
                                            <span class="fw-bold" id="apiResponseTime">-</span>
                                        </div>
                                        <div class="metric-item">
                                            <span>Cache Hit Rate: </span>
                                            <span class="fw-bold" id="cacheHitRate">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="exportAnalytics()">Export Analytics</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Citizen Science Observation Modal -->
    <div class="modal fade" id="observationModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-seedling me-2"></i>üå± Share Your Plant Observation!
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="observationForm" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="observationTitle" class="form-label">
                                        <i class="fas fa-heading me-1"></i>üåø What did you see?
                                    </label>
                                    <input type="text" class="form-control" id="observationTitle" 
                                           placeholder="e.g., Beautiful Cherry Blossoms in the Park" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="plantSpecies" class="form-label">
                                        <i class="fas fa-leaf me-1"></i>üå± Plant Type
                                    </label>
                                    <select class="form-select" id="plantSpecies" required>
                                        <option value="">Choose a plant type...</option>
                                        <option value="cherry_blossom">üå∏ Cherry Blossom</option>
                                        <option value="daffodil">üåº Daffodil</option>
                                        <option value="tulip">üå∑ Tulip</option>
                                        <option value="rose">üåπ Rose</option>
                                        <option value="sunflower">üåª Sunflower</option>
                                        <option value="lily">üå∫ Lily</option>
                                        <option value="daisy">üåº Daisy</option>
                                        <option value="lavender">üíú Lavender</option>
                                        <option value="oak_tree">üå≥ Oak Tree</option>
                                        <option value="pine_tree">üå≤ Pine Tree</option>
                                        <option value="maple_tree">üçÅ Maple Tree</option>
                                        <option value="other">üåø Other Plant</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="bloomStatus" class="form-label">
                                        <i class="fas fa-chart-line me-1"></i>üìà How is it growing?
                                    </label>
                                    <select class="form-select" id="bloomStatus" required>
                                        <option value="">Choose growth stage...</option>
                                        <option value="budding">üå± Just Starting to Grow</option>
                                        <option value="early_bloom">üåø Beginning to Bloom</option>
                                        <option value="full_bloom">üå∏ Fully Bloomed</option>
                                        <option value="late_bloom">üçÇ Almost Done Blooming</option>
                                        <option value="dormant">üò¥ Sleeping for Winter</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="observerName" class="form-label">
                                        <i class="fas fa-user me-1"></i>üë§ Your Name (optional)
                                    </label>
                                    <input type="text" class="form-control" id="observerName" 
                                           placeholder="e.g., Nature Explorer">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="observationText" class="form-label">
                                        <i class="fas fa-comment me-1"></i>üìù Tell us about it!
                                    </label>
                                    <textarea class="form-control" id="observationText" rows="4" 
                                              placeholder="Describe what you saw! What color was it? How big? Any interesting details?"></textarea>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="observationImage" class="form-label">
                                        <i class="fas fa-camera me-1"></i>üì∏ Add a Photo (optional)
                                    </label>
                                    <input type="file" class="form-control" id="observationImage" 
                                           accept="image/*" onchange="previewImage(this)">
                                    <div class="form-text">Take a picture of the plant you observed!</div>
                                </div>
                                
                                <div class="mb-3" id="imagePreview" style="display: none;">
                                    <label class="form-label">üì∏ Photo Preview</label>
                                    <div class="text-center">
                                        <img id="previewImg" class="img-thumbnail" style="max-width: 200px; max-height: 200px;">
                                        <button type="button" class="btn btn-sm btn-outline-danger mt-2" onclick="removeImage()">
                                            <i class="fas fa-trash me-1"></i>Remove Photo
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="location" class="form-label">
                                        <i class="fas fa-map-marker-alt me-1"></i>üìç Where did you see it?
                                    </label>
                                    <input type="text" class="form-control" id="location" 
                                           placeholder="e.g., Central Park, New York" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Thank you for helping scientists!</strong> Your observations help us understand how plants grow around the world! üåç‚ú®
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancel
                    </button>
                    <button type="button" class="btn btn-success" onclick="submitObservation()">
                        <i class="fas fa-paper-plane me-1"></i>üå± Share My Observation!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 3D Globe Modal -->
    <div class="modal fade" id="globeModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-globe me-2"></i>3D Globe Visualization
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div id="globeContainer" style="height: 600px; position: relative;">
                        <div id="globeControls" class="position-absolute top-0 end-0 p-3" style="z-index: 1000;">
                            <div class="btn-group-vertical" role="group">
                                <button type="button" class="btn btn-outline-light btn-sm mb-1" onclick="globeApp.resetView()">
                                    <i class="fas fa-home"></i>
                                </button>
                                <button type="button" class="btn btn-outline-light btn-sm mb-1" onclick="globeApp.toggleAnimation()">
                                    <i class="fas fa-play" id="animationIcon"></i>
                                </button>
                                <button type="button" class="btn btn-outline-light btn-sm mb-1" onclick="globeApp.toggleBloomData()">
                                    <i class="fas fa-seedling" id="bloomIcon"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Layer Controls -->
                        <div id="layerControls" class="position-absolute top-0 start-0 p-3" style="z-index: 1000;">
                            <div class="card bg-dark text-white" style="width: 200px; opacity: 0.9;">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-layer-group me-2"></i>Layers</h6>
                                </div>
                                <div class="card-body p-2">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="temperatureLayer" onchange="globeApp.toggleLayer('temperature')">
                                        <label class="form-check-label" for="temperatureLayer">
                                            <i class="fas fa-thermometer-half me-1"></i>Temperature
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="windLayer" onchange="globeApp.toggleLayer('wind')">
                                        <label class="form-check-label" for="windLayer">
                                            <i class="fas fa-wind me-1"></i>Wind Currents
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="vegetationLayer" onchange="globeApp.toggleLayer('vegetation')">
                                        <label class="form-check-label" for="vegetationLayer">
                                            <i class="fas fa-leaf me-1"></i>Vegetation
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="precipitationLayer" onchange="globeApp.toggleLayer('precipitation')">
                                        <label class="form-check-label" for="precipitationLayer">
                                            <i class="fas fa-cloud-rain me-1"></i>Precipitation
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="elevationLayer" onchange="globeApp.toggleLayer('elevation')">
                                        <label class="form-check-label" for="elevationLayer">
                                            <i class="fas fa-mountain me-1"></i>Elevation
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="globeInfo" class="position-absolute bottom-0 start-0 p-3 text-white" style="z-index: 1000; background: rgba(0,0,0,0.7); border-radius: 0 10px 0 0;">
                            <small>
                                <div>Data Points: <span id="globeDataCount">0</span></div>
                                <div>Animation: <span id="globeAnimationStatus">Paused</span></div>
                                <div>Bloom Data: <span id="globeBloomStatus">Hidden</span></div>
                                <div>Active Layers: <span id="activeLayers">None</span></div>
                            </small>
                        </div>
                        <div id="nasaGlobeInfo" class="position-absolute bottom-0 end-0 p-3 text-white" style="z-index: 1000; background: rgba(0,0,0,0.7); border-radius: 10px 0 0 0; max-width: 300px;">
                            <!-- NASA data source information will be loaded here -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}?v=2.7"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        
        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button
            const installButton = document.createElement('button');
            installButton.className = 'btn btn-success position-fixed';
            installButton.style.cssText = 'bottom: 20px; right: 20px; z-index: 9999;';
            installButton.innerHTML = '<i class="fas fa-download me-2"></i>Install App';
            installButton.onclick = () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    }
                    deferredPrompt = null;
                    installButton.remove();
                });
            };
            document.body.appendChild(installButton);
        });
    </script>
</body>
</html>
