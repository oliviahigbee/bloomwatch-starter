<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üå± BloomWatch Kids - Learn About Plants & Nature!</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Fun educational app for kids to learn about plants, nature, and conservation using real NASA data!">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="BloomWatch">
    <meta name="msapplication-TileColor" content="#28a745">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#28a745">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Comic+Neue:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        // Ensure OrbitControls is available
        if (typeof THREE !== 'undefined' && typeof THREE.OrbitControls === 'undefined') {
            // Fallback: create a simple orbit control if the import failed
            THREE.OrbitControls = function(camera, domElement) {
                this.camera = camera;
                this.domElement = domElement;
                this.enableDamping = true;
                this.dampingFactor = 0.05;
                this.enableZoom = true;
                this.enablePan = false;
                this.minDistance = 1.5;
                this.maxDistance = 5;
                
                this.update = function() {
                    // Simple rotation
                    this.camera.position.x = Math.cos(Date.now() * 0.0005) * 3;
                    this.camera.position.z = Math.sin(Date.now() * 0.0005) * 3;
                    this.camera.lookAt(0, 0, 0);
                };
                
                this.reset = function() {
                    this.camera.position.set(0, 0, 3);
                };
            };
        }
    </script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-seedling me-2"></i>üå± BloomWatch Kids
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text" id="currentLocationDisplay">
                    <i class="fas fa-rocket me-1"></i>Powered by NASA Space Data! üöÄ
                </span>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h1 class="display-4 fw-bold text-white mb-4">
                        üåü Discover Amazing Plants Around the World! üåü
                    </h1>
                    <p class="lead text-white mb-4">
                        Join us on an exciting adventure to learn about plants, flowers, and nature! 
                        We use real NASA satellite pictures from space to see how plants grow all over our beautiful Earth! üåç‚ú®
                    </p>
                    <div class="d-flex gap-3">
                        <button class="btn btn-light btn-lg" onclick="scrollToMap()">
                            <i class="fas fa-globe me-2"></i>üåç Explore the World Map
                        </button>
                        <button class="btn btn-outline-light btn-lg" onclick="scrollToAnalysis()">
                            <i class="fas fa-chart-line me-2"></i>üìä See Plant Data
                        </button>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="hero-stats">
                        <div class="row text-center">
                            <div class="col-3">
                                <div class="stat-item">
                                    <h3 class="text-white">üå±</h3>
                                    <p class="text-white-50">Plants</p>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="stat-item">
                                    <h3 class="text-white">üåç</h3>
                                    <p class="text-white-50">World Map</p>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="stat-item">
                                    <h3 class="text-white">üöÄ</h3>
                                    <p class="text-white-50">NASA Space</p>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="stat-item">
                                    <h3 class="text-white">üéì</h3>
                                    <p class="text-white-50">Learning</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Controls Section -->
    <div class="container my-5">
        <div class="row">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-magic me-2"></i>üéÆ Fun Learning Controls
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <label for="citySelect" class="form-label">üåç Choose a Place to Explore!</label>
                                <select class="form-select" id="citySelect" onchange="updateCity()">
                                    <option value="global">üåç See the Whole World!</option>
                                    <option value="new-york">üóΩ New York City</option>
                                    <option value="london">üè∞ London</option>
                                    <option value="tokyo">üóæ Tokyo</option>
                                    <option value="sao-paulo">üå¥ S√£o Paulo</option>
                                    <option value="sydney">ü¶ò Sydney</option>
                                    <option value="cape-town">üèîÔ∏è Cape Town</option>
                                    <option value="mumbai">üïå Mumbai</option>
                                    <option value="paris">üóº Paris</option>
                                    <option value="los-angeles">üå¥ Los Angeles</option>
                                    <option value="buenos-aires">üå∫ Buenos Aires</option>
                                    <option value="cairo">üè∫ Cairo</option>
                                    <option value="moscow">‚ùÑÔ∏è Moscow</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="timeRange" class="form-label">‚è∞ How Far Back in Time?</label>
                                <select class="form-select" id="timeRange" onchange="updateTimeRange()">
                                    <option value="1">üìÖ Last Year</option>
                                    <option value="3">üìÖ Last 3 Years</option>
                                    <option value="5" selected>üìÖ Last 5 Years</option>
                                    <option value="10">üìÖ Last 10 Years</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="vegetationIndex" class="form-label">üåø Plant Health Meter</label>
                                <select class="form-select" id="vegetationIndex" onchange="updateVegetationIndex()">
                                    <option value="ndvi" selected>üå± Green Plant Health</option>
                                    <option value="evi">üåø Enhanced Plant Health</option>
                                    <option value="savi">üåæ Soil-Adjusted Health</option>
                                    <option value="gndvi">üå≥ Green Leaf Health</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">&nbsp;</label>
                                <div>
                                    <button class="btn btn-success w-100" onclick="refreshData()">
                                        <i class="fas fa-sync-alt me-2"></i>üîÑ Get New Data!
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Fun Learning Features Row -->
                        <div class="row mt-3">
                            <div class="col-md-3">
                                <button class="btn btn-primary w-100" onclick="predictBloom()">
                                    <i class="fas fa-crystal-ball me-2"></i>üîÆ Predict Plant Growth!
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-warning w-100" onclick="detectAnomalies()">
                                    <i class="fas fa-search me-2"></i>üîç Find Special Plants!
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-info w-100" onclick="analyzeClimate()">
                                    <i class="fas fa-thermometer-half me-2"></i>üå°Ô∏è Weather & Plants
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-success w-100" onclick="showCitizenScience()">
                                    <i class="fas fa-users me-2"></i>üå± Citizen Science
                                </button>
                            </div>
                        </div>
                        
                        <!-- Additional Features Row -->
                        <div class="row mt-3">
                            <div class="col-md-3">
                                <button class="btn btn-dark w-100" onclick="view3DGlobe()">
                                    <i class="fas fa-globe me-2"></i>üåç 3D Earth Explorer
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-outline-primary w-100" onclick="showObservationForm()">
                                    <i class="fas fa-plus me-2"></i>üìù Share Observation
                                </button>
                            </div>
                            <div class="col-md-6">
                                <!-- Empty space for future features -->
                            </div>
                        </div>
                        
                        <!-- Fun Learning Tools Row -->
                        <div class="row mt-3">
                            <div class="col-md-2">
                                <button class="btn btn-success w-100" onclick="app.exportData('json')">
                                    <i class="fas fa-download me-2"></i>üìÑ Save Data
                                </button>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-info w-100" onclick="app.exportData('csv')">
                                    <i class="fas fa-file-csv me-2"></i>üìä Save Chart
                                </button>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-warning w-100" onclick="app.exportData('geojson')">
                                    <i class="fas fa-map me-2"></i>üó∫Ô∏è Save Map
                                </button>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-primary w-100" onclick="app.shareData('link')">
                                    <i class="fas fa-share me-2"></i>üì§ Share with Friends!
                                </button>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-secondary w-100" onclick="toggleRealTimeUpdates()">
                                    <i class="fas fa-sync-alt me-2" id="realTimeIcon"></i><span id="realTimeText">üîÑ Live Updates ON</span>
                                </button>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-outline-dark w-100" onclick="showAdvancedAnalytics()">
                                    <i class="fas fa-chart-pie me-2"></i>üìà Fun Stats
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Global Map Section -->
    <div class="container my-5" id="mapSection">
        <div class="row">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-map me-2"></i><span id="mapTitle">üåç Amazing Plant World Map</span>
                        </h5>
                        <small class="text-muted" id="mapDescription">Click on the colorful dots to learn about plants in different places! üå±</small>
                    </div>
                    <div class="card-body p-0">
                        <div id="globalMap" style="height: 500px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analysis Section -->
    <div class="container my-5" id="analysisSection">
        <div class="row">
            <!-- Time Series Chart -->
            <div class="col-lg-10">
                <div class="card shadow mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-line me-2"></i>üìà How Plants Grow Over Time!
                        </h5>
                    </div>
                    <div class="card-body">
                        <canvas id="timeSeriesChart" height="300"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Key Metrics -->
            <div class="col-lg-2">
                <div class="card shadow mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-bar me-2"></i>üìä Plant Health Scoreboard!
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="metric-item mb-3">
                            <div class="d-flex justify-content-between">
                                <span>üå± How Green Are the Plants?</span>
                                <span class="fw-bold" id="currentIntensity">-</span>
                            </div>
                            <div class="progress mt-1">
                                <div class="progress-bar bg-success" id="intensityBar" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div class="metric-item mb-3">
                            <div class="d-flex justify-content-between">
                                <span>üå∏ Best Blooming Day</span>
                                <span class="fw-bold" id="peakDate">-</span>
                            </div>
                        </div>
                        
                        <div class="metric-item mb-3">
                            <div class="d-flex justify-content-between">
                                <span>üìà Are Plants Growing More?</span>
                                <span class="fw-bold" id="trend">-</span>
                            </div>
                        </div>
                        
                        <div class="metric-item">
                            <div class="d-flex justify-content-between">
                                <span>üå∫ Best Season for Flowers</span>
                                <span class="fw-bold" id="peakSeason">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI & Advanced Analytics -->
        <div class="row mb-4">
            <div class="col-lg-8">
                <div class="card shadow" id="predictionCard" style="display: none;">
                    <!-- AI Prediction content will be loaded here -->
                </div>
            </div>
            <div class="col-lg-4">
                <div class="row">
                    <div class="col-12 mb-3">
                        <div class="card shadow" id="anomaliesCard" style="display: none;">
                            <!-- Anomaly detection content will be loaded here -->
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="card shadow" id="climateCard" style="display: none;">
                            <!-- Climate correlation content will be loaded here -->
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="card shadow" id="nasaAttributionCard" style="display: none;">
                            <!-- NASA data attribution will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Citizen Science & 3D Visualization -->
        <div class="row mb-4">
            <div class="col-lg-6">
                <div class="card shadow" id="citizenCard" style="display: none;">
                    <!-- Citizen science content will be loaded here -->
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card shadow" id="globeCard" style="display: none;">
                    <!-- 3D Globe content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Conservation Insights -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-leaf me-2"></i>üåø Fun Plant Facts & How to Help Nature!
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>üåü Cool Plant Facts!</h6>
                                <ul id="insightsList" class="list-unstyled">
                                    <li><i class="fas fa-spinner fa-spin me-2"></i>Loading fun facts...</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>üå± How You Can Help Plants!</h6>
                                <ul id="recommendationsList" class="list-unstyled">
                                    <li><i class="fas fa-spinner fa-spin me-2"></i>Loading helpful tips...</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h6>üå± BloomWatch Kids</h6>
                    <p class="mb-0">Learning about plants and nature with real NASA space data! üöÄ</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">
                        <i class="fas fa-rocket me-1"></i>
                        Powered by NASA Space Data! üåü
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Loading Modal -->
    <div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center py-4">
                    <div class="spinner-border text-success mb-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h5>üöÄ Getting Data from Space!</h5>
                    <p class="text-muted">Looking at satellite pictures to see how plants are growing! üå±</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Analytics Modal -->
    <div class="modal fade" id="analyticsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-chart-pie me-2"></i>Advanced Analytics Dashboard
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-database me-2"></i>Data Quality Metrics</h6>
                                </div>
                                <div class="card-body">
                                    <div id="dataQualityMetrics">
                                        <div class="metric-item mb-2">
                                            <span>Completeness: </span>
                                            <span class="fw-bold" id="dataCompleteness">-</span>
                                        </div>
                                        <div class="metric-item mb-2">
                                            <span>Accuracy: </span>
                                            <span class="fw-bold" id="dataAccuracy">-</span>
                                        </div>
                                        <div class="metric-item mb-2">
                                            <span>Timeliness: </span>
                                            <span class="fw-bold" id="dataTimeliness">-</span>
                                        </div>
                                        <div class="metric-item">
                                            <span>Coverage: </span>
                                            <span class="fw-bold" id="dataCoverage">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-brain me-2"></i>AI Model Performance</h6>
                                </div>
                                <div class="card-body">
                                    <div id="modelPerformance">
                                        <div class="metric-item mb-2">
                                            <span>Prediction Accuracy: </span>
                                            <span class="fw-bold" id="predictionAccuracy">-</span>
                                        </div>
                                        <div class="metric-item mb-2">
                                            <span>Model Confidence: </span>
                                            <span class="fw-bold" id="modelConfidence">-</span>
                                        </div>
                                        <div class="metric-item mb-2">
                                            <span>Training Data Points: </span>
                                            <span class="fw-bold" id="trainingDataPoints">-</span>
                                        </div>
                                        <div class="metric-item">
                                            <span>Last Updated: </span>
                                            <span class="fw-bold" id="lastModelUpdate">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-users me-2"></i>User Engagement</h6>
                                </div>
                                <div class="card-body">
                                    <div id="userEngagement">
                                        <div class="metric-item mb-2">
                                            <span>Session Duration: </span>
                                            <span class="fw-bold" id="sessionDuration">-</span>
                                        </div>
                                        <div class="metric-item mb-2">
                                            <span>Interactions: </span>
                                            <span class="fw-bold" id="userInteractions">-</span>
                                        </div>
                                        <div class="metric-item mb-2">
                                            <span>Features Used: </span>
                                            <span class="fw-bold" id="featuresUsed">-</span>
                                        </div>
                                        <div class="metric-item">
                                            <span>Data Exports: </span>
                                            <span class="fw-bold" id="dataExports">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-tachometer-alt me-2"></i>System Performance</h6>
                                </div>
                                <div class="card-body">
                                    <div id="systemPerformance">
                                        <div class="metric-item mb-2">
                                            <span>Page Load Time: </span>
                                            <span class="fw-bold" id="pageLoadTime">-</span>
                                        </div>
                                        <div class="metric-item mb-2">
                                            <span>Memory Usage: </span>
                                            <span class="fw-bold" id="memoryUsage">-</span>
                                        </div>
                                        <div class="metric-item mb-2">
                                            <span>API Response Time: </span>
                                            <span class="fw-bold" id="apiResponseTime">-</span>
                                        </div>
                                        <div class="metric-item">
                                            <span>Cache Hit Rate: </span>
                                            <span class="fw-bold" id="cacheHitRate">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="exportAnalytics()">Export Analytics</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Citizen Science Observation Modal -->
    <div class="modal fade" id="observationModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-seedling me-2"></i>üå± Share Your Plant Observation!
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="observationForm" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="observationTitle" class="form-label">
                                        <i class="fas fa-heading me-1"></i>üåø What did you see?
                                    </label>
                                    <input type="text" class="form-control" id="observationTitle" 
                                           placeholder="e.g., Beautiful Cherry Blossoms in the Park" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="plantSpecies" class="form-label">
                                        <i class="fas fa-leaf me-1"></i>üå± Plant Type
                                    </label>
                                    <select class="form-select" id="plantSpecies" required>
                                        <option value="">Choose a plant type...</option>
                                        <option value="cherry_blossom">üå∏ Cherry Blossom</option>
                                        <option value="daffodil">üåº Daffodil</option>
                                        <option value="tulip">üå∑ Tulip</option>
                                        <option value="rose">üåπ Rose</option>
                                        <option value="sunflower">üåª Sunflower</option>
                                        <option value="lily">üå∫ Lily</option>
                                        <option value="daisy">üåº Daisy</option>
                                        <option value="lavender">üíú Lavender</option>
                                        <option value="oak_tree">üå≥ Oak Tree</option>
                                        <option value="pine_tree">üå≤ Pine Tree</option>
                                        <option value="maple_tree">üçÅ Maple Tree</option>
                                        <option value="other">üåø Other Plant</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="bloomStatus" class="form-label">
                                        <i class="fas fa-chart-line me-1"></i>üìà How is it growing?
                                    </label>
                                    <select class="form-select" id="bloomStatus" required>
                                        <option value="">Choose growth stage...</option>
                                        <option value="budding">üå± Just Starting to Grow</option>
                                        <option value="early_bloom">üåø Beginning to Bloom</option>
                                        <option value="full_bloom">üå∏ Fully Bloomed</option>
                                        <option value="late_bloom">üçÇ Almost Done Blooming</option>
                                        <option value="dormant">üò¥ Sleeping for Winter</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="observerName" class="form-label">
                                        <i class="fas fa-user me-1"></i>üë§ Your Name (optional)
                                    </label>
                                    <input type="text" class="form-control" id="observerName" 
                                           placeholder="e.g., Nature Explorer">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="observationText" class="form-label">
                                        <i class="fas fa-comment me-1"></i>üìù Tell us about it!
                                    </label>
                                    <textarea class="form-control" id="observationText" rows="4" 
                                              placeholder="Describe what you saw! What color was it? How big? Any interesting details?"></textarea>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="observationImage" class="form-label">
                                        <i class="fas fa-camera me-1"></i>üì∏ Add a Photo (optional)
                                    </label>
                                    <input type="file" class="form-control" id="observationImage" 
                                           accept="image/*" onchange="previewImage(this)">
                                    <div class="form-text">Take a picture of the plant you observed!</div>
                                </div>
                                
                                <div class="mb-3" id="imagePreview" style="display: none;">
                                    <label class="form-label">üì∏ Photo Preview</label>
                                    <div class="text-center">
                                        <img id="previewImg" class="img-thumbnail" style="max-width: 200px; max-height: 200px;">
                                        <button type="button" class="btn btn-sm btn-outline-danger mt-2" onclick="removeImage()">
                                            <i class="fas fa-trash me-1"></i>Remove Photo
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="location" class="form-label">
                                        <i class="fas fa-map-marker-alt me-1"></i>üìç Where did you see it?
                                    </label>
                                    <input type="text" class="form-control" id="location" 
                                           placeholder="e.g., Central Park, New York" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Thank you for helping scientists!</strong> Your observations help us understand how plants grow around the world! üåç‚ú®
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancel
                    </button>
                    <button type="button" class="btn btn-success" onclick="submitObservation()">
                        <i class="fas fa-paper-plane me-1"></i>üå± Share My Observation!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 3D Globe Modal -->
    <div class="modal fade" id="globeModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-globe me-2"></i>3D Globe Visualization
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div id="globeContainer" style="height: 600px; position: relative;">
                        <div id="globeControls" class="position-absolute top-0 end-0 p-3" style="z-index: 1000;">
                            <div class="btn-group-vertical" role="group">
                                <button type="button" class="btn btn-outline-light btn-sm mb-1" onclick="globeApp.resetView()">
                                    <i class="fas fa-home"></i>
                                </button>
                                <button type="button" class="btn btn-outline-light btn-sm mb-1" onclick="globeApp.toggleAnimation()">
                                    <i class="fas fa-play" id="animationIcon"></i>
                                </button>
                                <button type="button" class="btn btn-outline-light btn-sm mb-1" onclick="globeApp.toggleBloomData()">
                                    <i class="fas fa-seedling" id="bloomIcon"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Layer Controls -->
                        <div id="layerControls" class="position-absolute top-0 start-0 p-3" style="z-index: 1000;">
                            <div class="card bg-dark text-white" style="width: 200px; opacity: 0.9;">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-layer-group me-2"></i>Layers</h6>
                                </div>
                                <div class="card-body p-2">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="temperatureLayer" onchange="globeApp.toggleLayer('temperature')">
                                        <label class="form-check-label" for="temperatureLayer">
                                            <i class="fas fa-thermometer-half me-1"></i>Temperature
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="windLayer" onchange="globeApp.toggleLayer('wind')">
                                        <label class="form-check-label" for="windLayer">
                                            <i class="fas fa-wind me-1"></i>Wind Currents
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="vegetationLayer" onchange="globeApp.toggleLayer('vegetation')">
                                        <label class="form-check-label" for="vegetationLayer">
                                            <i class="fas fa-leaf me-1"></i>Vegetation
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="precipitationLayer" onchange="globeApp.toggleLayer('precipitation')">
                                        <label class="form-check-label" for="precipitationLayer">
                                            <i class="fas fa-cloud-rain me-1"></i>Precipitation
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="elevationLayer" onchange="globeApp.toggleLayer('elevation')">
                                        <label class="form-check-label" for="elevationLayer">
                                            <i class="fas fa-mountain me-1"></i>Elevation
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="globeInfo" class="position-absolute bottom-0 start-0 p-3 text-white" style="z-index: 1000; background: rgba(0,0,0,0.7); border-radius: 0 10px 0 0;">
                            <small>
                                <div>Data Points: <span id="globeDataCount">0</span></div>
                                <div>Animation: <span id="globeAnimationStatus">Paused</span></div>
                                <div>Bloom Data: <span id="globeBloomStatus">Hidden</span></div>
                                <div>Active Layers: <span id="activeLayers">None</span></div>
                            </small>
                        </div>
                        <div id="nasaGlobeInfo" class="position-absolute bottom-0 end-0 p-3 text-white" style="z-index: 1000; background: rgba(0,0,0,0.7); border-radius: 10px 0 0 0; max-width: 300px;">
                            <!-- NASA data source information will be loaded here -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}?v=2.7"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        
        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button
            const installButton = document.createElement('button');
            installButton.className = 'btn btn-success position-fixed';
            installButton.style.cssText = 'bottom: 20px; right: 20px; z-index: 9999;';
            installButton.innerHTML = '<i class="fas fa-download me-2"></i>Install App';
            installButton.onclick = () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    }
                    deferredPrompt = null;
                    installButton.remove();
                });
            };
            document.body.appendChild(installButton);
        });
    </script>
</body>
</html>
